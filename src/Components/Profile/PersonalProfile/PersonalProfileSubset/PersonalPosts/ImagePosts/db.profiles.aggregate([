db.profiles.aggregate([
	{$match:{_id:ObjectId("6005920c1f04930c579302c7")}},
	{$project:{
		championData:1,
		firstTimeLoggedIn:1,
		socialMediaUrls:1,
		imagePost:{
			$reverseArray:"$imagePost"
		},
		firstName:1,
		friendsGaugeNodes:1,
		recruits:1,
		'crownPost.image':1
	}},
	{$addFields:{
		imagePost:{
			$slice:["$imagePost",0,20]
		}
	}},
	{$unwind:{
		path:"$crownPost.image",
        preserveNullAndEmptyArrays: true
	}},
	{$addFields:{
		crownedPost:"$crownPost.image"
	}},
	{$lookup:{
		from:"imageposts",
		let:{postId:"$crownedPost"},
		pipeline:[
			{$match:{
				$expr:{
					$and:[
						{$eq:["$_id","$$postId"]},
						{$ne:[{$size:'$industriesUploaded'},0]}
					]
				}
			}}
		],
		as:"crownedPost"
	}},
	{$unwind:{
		path:"$crownedPost",
        preserveNullAndEmptyArrays: true
	}},
	{$unwind:{
		path:"$imagePost",
        preserveNullAndEmptyArrays: true
	}},
	{$lookup:{
		from:"imageposts",
		let:{postId:"$imagePost"},
		pipeline:[
			{$match:{
				$expr:{
					$and:[
						{$eq:["$_id","$$postId"]},
						{$or:[
							{$ne:["$levelNode",""]},
							{$in:["$levelNode",["6008fa28dde9850beac35504"]]}
						]}
					]
				}
			}}
		],
		as:"imagePost"
	}},
	{$unwind:{
		path:"$imagePost",
        preserveNullAndEmptyArrays: true
	}},
	{$group:{
		_id:"$_id",
		championData:{$first:"$championData"},
		firstTimeLoggedIn:{$first:"$firstTimeLoggedIn"},
		socialMediaUrls:{$first:"$socialMediaUrls"},
		firstName:{$first:"$firstName"},
		friendsGaugeNodes:{$first:"$friendsGaugeNodes"},
		recruits:{$first:"$recruits"},
		crownedPost:{$first:"$crownedPost"},
		imagePost:{$addToSet:"$imagePost"}
	}},
	{$unwind:{
		path:"$recruits",
        preserveNullAndEmptyArrays: true
	}},
	{$lookup:{
		from:"profiles",
		let:{userId:"$recruits"},
		pipeline:[
			{$match:{
				$expr:{
					$eq:["$_id","$$userId"]
				}
			}},
			{$project:{
				_id:"$_id",
				firstName:"$firstName"
			}}
		],
		as:"recruits"
	}}
]).pretty()




db.profiles.aggregate([
	{$match:{_id:ObjectId("6005920c1f04930c579302c7")}},
	{$project:{
		videoPosts:{
			$reverseArray:"$videoPosts"
		},
		'crownPost.video':1
	}},
	{$addFields:{
		videoPosts:{
			$slice:["$videoPosts",10,10]
		}
	}},
	{$unwind:{
		path:"$videoPosts",
        preserveNullAndEmptyArrays: true
	}},
	{$lookup:{
		from:"videoposts",
		let:{postId:"$videoPosts"},
		pipeline:[
			{$match:{
				$expr:{
					$and:[
						{$eq:["$_id","$$postId"]},
						{$ne:[{$size:'$industriesUploaded'},0]}
					]
				}
			}}
		],
		as:"videoPosts"
	}},
	{$unwind:{
		path:"$videoPosts",
        preserveNullAndEmptyArrays: true
	}},
	{$group:{
		_id:"$_id",
		crownedPost:{$first:"$crownedPost"},
		videoPosts:{$addToSet:"$videoPosts"}
	}}
]).pretty()










db.industryposts.aggregate([
	{$match:{
		industry:"General"
	}},
	{$project:{
		posts:{
			$reverseArray:"$imagePostsInIndustry"
		},
		symposium:"$industry"
	}},
	{$addFields:{
		posts:{
			$slice:["$posts",20,20]
		}
	}},
	{$unwind:"$posts"},
	{$lookup:{
		from:"imageposts",
		let:{postId:"$posts"},
		pipeline:[
			{$match:{
				$expr:{
					$eq:["$_id","$$postId"]
				}
			}},
			{$lookup:{
				from:"profiles",
				let:{userId:"$owner"},
				pipeline:[
					{$match:{
						$expr:{
							$eq:["$_id","$$userId"]
						}
					}},
					{$project:{
						firstName:1,
						recruits:1
					}}
				],
				as:"owner"
			}}
		],
		as:"symposiumPosts"
	}},
	{$unwind:"$symposiumPosts"},
	{$unwind:"$symposiumPosts.owner"},
	{$group:{
		_id:"$_id",
		symposiumPosts:{$addToSet:"$symposiumPosts"},
		symposium:{$first:"$symposium"}
	}},
	{$project:{
		sizeOfResults:{
			$size:"$symposiumPosts"
		}
	}}
]).pretty()



db.imageposts.aggregate([
	{$match:{
		levelNode:"",
        $or:[
         	{
	            description:{
	                $regex:/Postman/
	            }
	        },
	        {
	            caption:{
	                 $regex:/Postman/
	            }
	        }
        ]
	}},
	{$addFields:{
		groupParameter:"123"
	}},
	{$group:{
		_id:"$groupParameter",
		posts:{$addToSet:"$_id"}
	}},
	{$project:{
		posts:{
			$reverseArray:"$posts"
		},
	}},
	{$addFields:{
		posts:{
			$slice:["$posts",0,20]
		}
	}},
	{$unwind:"$posts"},
	{$lookup:{
		from:"imageposts",
		let:{postId:"$posts"},
		pipeline:[
			{$match:{
				$expr:{
					$and:[
						{$eq:["$_id","$$postId"]},
						{$eq:["$levelNode",""]}
					]
				}
			}},
			{$lookup:{
				from:"profiles",
				let:{userId:"$owner"},
				pipeline:[
					{$match:{
						$expr:{
							$eq:["$_id","$$userId"]
						}
					}},
					{$project:{
						firstName:1,
						recruits:1
					}}
				],
				as:"owner"
			}}
		],
		as:"posts"
	}},
	{$unwind:"$posts"},
	{$unwind:"$posts.owner"}
]).pretty()
















db.subcommunityposts.aggregate([
	{$match:{
		parentCommunity:"Mathematics",
		imagePostsInSubCommunity:{
			$gte:[{$size:"$imagePostsInSubCommunity"},1]
		}
	}},
	{$project:{
		imagePostsInSubCommunity:{
			$reverseArray:"$imagePostsInSubCommunity"
		}
	}},
	{$addFields:{
		imagePostsInSubCommunity:{
			$slice:["$imagePostsInSubCommunity",0,10]
		}
	}},
	{$unwind:"$imagePostsInSubCommunity"},
	{$group:{
		_id:"$parentCommunity",
		subSymposiumPosts:{$addToSet:"$imagePostsInSubCommunity"}
	}},
	{$unwind:"$subSymposiumPosts"},
	{$lookup:{
		from:"imageposts",
		let:{postId:"$subSymposiumPosts"},
		pipeline:[
			{$match:{
				$expr:{
					$eq:["$_id","$$postId"]
				}
			}},
			{$lookup:{
				from:"profiles",
				let:{userId:"$owner"},
				pipeline:[
					{$match:{
						$expr:{
							$eq:["$_id","$$userId"]
						}
					}},
					{$project:{
						firstName:1,
						recruits:1
					}}
				],
				as:"owner"
			}}
		],
		as:"posts"
	}},
	{$unwind:"$posts"},
	{$unwind:"$posts.owner"},
	{$group:{
		_id:"$_id",
		subSymposiumPosts:{$addToSet:"$posts"}
	}},
	{$project:{
		_id:"$_id",
		symposiumPosts:"$symposiumPosts",
		symposium:"$symposium",
		subSymposiumPosts:"$subSymposiumPosts.subSymposiumPosts"
	}}
]).pretty()














	{$lookup:{
		from:"subcommunityposts",
		let:{subSymposium:"$symposium"},
		pipeline:[
			{$match:{
				$expr:{
					$and:[
						{$eq:["$parentCommunity","$$subSymposium"]},
						{$gte:[{$size:"$imagePostsInSubCommunity"},1]}
					]
				}
			}},
			{}
		],
		as:"subSymposium"
	}}










	ObjectId("600769d133955d20b9ba4f22"),
		ObjectId("600769d033955d20b9ba4f20"),
		ObjectId("600769cf33955d20b9ba4f1e"),
		ObjectId("600769ce33955d20b9ba4f1c"),
		ObjectId("600769cd33955d20b9ba4f1a"),
		ObjectId("600769cd33955d20b9ba4f18"),
		ObjectId("600769cc33955d20b9ba4f16"),
		ObjectId("600769cb33955d20b9ba4f14"),
		ObjectId("600769ca33955d20b9ba4f12"),
		ObjectId("600769c933955d20b9ba4f10")























	{$unwind:"$videoPosts"},
	{$project:{
		post:"$videoPosts"
	}}




	}},
	{$addFields:{
		imagePost:{
			$slice:["$imagePost",20,40]
		}
	}},
	{$unwind:"$imagePost"},
	{$lookup:{
		from:"imageposts",
		let:{postId:"$imagePost"},
		pipeline:[
			{$match:{
				$expr:{
					$and:[
						{$eq:["$_id","$$postId"]},
						{$ne:[{$size:'$industriesUploaded'},0]}
					]
				}
			}}
		],
		as:"imagePost"
	}},
	{$unwind:"$imagePost"},
	{$project:{
		post:"$imagePost"
	}}














	$expr:{
		$and:[
			{$eq:["$_id","$$postId"]},
			{$ne:[{$size:'$industriesUploaded'},0]}
		]
	}








"image" : ObjectId("600769c933955d20b9ba4f10")


,
	{$lookup:{
		from:"imagePost",
		let:{postId:"imagePost"},
		pipeline:[
			{$match:{
				expr:{
					$eq:["$_id","$$postId"]
				}
			}}
		],
		as:"crownPost"
	}}

,
	{$unwind:"$imagePost"},
	{$lookup:{
		from:"imageposts",
		let:{posts:"$imagePost"},
		pipeline:[
			{$match:{
				$expr:{
					$eq:["$_id","$$posts"]
				}
			}}
		],
		as:"imagePost"
	}}


,
	{$group:{
		_id:"$_id"
		championData:{ $addToSet:"$championData"},
		firstTimeLoggedIn:{$addToSet:"$firstTimeLoggedIn"},
		socialMediaUrls:{$addToSet:"$socialMediaUrls"},
		firstName:{$addToSet:"$firstName"},
		friendsGaugeNodes:{$addToSet:"$friendsGaugeNodes"},
		recruits:{$addToSet:"$recruits"},
		imagePost:{
			$push:{
				_id:"$_id"
			}
		}
	}}



db.industryposts.aggregate([
	{$match:{
		_id:ObjectId('6005919462f6330ca9a7b638')
	}},
	{$project:{
		specificSymposiumQuestions:"$specificIndustryQuestions.imageQuestion"
	}},
	{$unwind:"$specificSymposiumQuestions"},
	{$match:{
		"specificSymposiumQuestions._id":ObjectId("6005919462f6330ca9a7b63a")
	}},
	{$project:{
		posts:"$specificSymposiumQuestions.responses"
	}},
	{$unwind:"$posts"},
	{$lookup:{
		from:"imageposts",
		let:{postId:"$posts"},
		pipeline:[
			{$match:{
				$expr:{
					$eq:["$_id","$$postId"]
				}
			}}
		],
		as:"post"
	}},
	{$unwind:"$posts"}
]).pretty()





























